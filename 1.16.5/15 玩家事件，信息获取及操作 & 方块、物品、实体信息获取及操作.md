### 15 玩家事件，信息获取及操作 & 方块、物品、实体信息获取及操作 & 玩家交互

------

#### 前言

本来15是要拆成两章的(玩家事件，信息获取及操作一章， 方块、物品、实体信息获取及交互一章)，但是发现这俩是紧密相关的，所以就有了这个超长的标题(

本章将以实例为主，讲解以上内容。

#### 一、玩家和实体

##### 1、信息获取

以下内容会返回玩家/实体的信息

| 格式                    | 功能                                           | 返回值类型               |
| ----------------------- | ---------------------------------------------- | ------------------------ |
| inventory               | 返回玩家的库存(仅适用于玩家)                   | InventoryJS[1]           |
| selectedSlot            | 返回当前玩家选中的格子(仅适用于玩家)           | 整形                     |
| mouseItem               | 返回当前玩家鼠标选取的物品(仅适用于玩家)       | ItemStackJS[2]           |
| creativeMode            | 返回当前玩家是否为创造模式(仅适用于玩家)       | 布尔值                   |
| spectator               | 返回当前玩家是否为观察者模式(仅适用于玩家)     | 布尔值                   |
| stats                   | 返回玩家统计数据(仅适用于玩家)                 | PlayerStatsJS[3]         |
| foodLevel               | 返回玩家饱食度等级(仅适用于玩家)               | 整形                     |
| xp                      | 返回玩家经验值(仅适用于玩家)                   | 整形                     |
| xplevel                 | 返回玩家经验等级(仅适用于玩家)                 | 整形                     |
| miningBlock             | 返回玩家是否正在破坏方块(仅适用于玩家)         | 布尔值                   |
| airSupply               | 返回玩家当前氧气供应值(仅适用于玩家)           | 整形                     |
| maxAirSupply            | 返回玩家最大氧气供应值(仅适用于玩家)           | 整形                     |
| stages                  | 返回玩家游戏阶段(仅适用于玩家)                 | Stages[4]                |
| name                    | 返回玩家名称                                   | Text                     |
| displayName             | 返回玩家显示名称                               | Text                     |
| alive                   | 返回游戏中玩家是否存活                         | 布尔值                   |
| living                  | 返回客户端是否处于活跃状态(焦点？)             | 布尔值                   |
| crouching               | 返回玩家是否正在潜行                           | 布尔值                   |
| sprinting               | 返回玩家是否正在疾跑                           | 布尔值                   |
| swimming                | 返回玩家是否正在游泳                           | 布尔值                   |
| glowing                 | 返回玩家是否正在发光                           | 布尔值                   |
| invisible               | 返回玩家是否隐形                               | 布尔值                   |
| invulnerable            | 返回玩家是否不受伤害                           | 布尔值                   |
| onGround                | 返回玩家是否站在地上                           | 布尔值                   |
| fallDistance            | 返回玩家目前掉落距离(落地后该值归0)            | 浮点型                   |
| noClip                  | 返回玩家是否没有碰撞箱(观察者模式下该值为true) | 布尔值                   |
| x y z                   | 玩家的x/y/z坐标                                | 浮点型                   |
| yaw pitch               | 偏航角/俯仰角                                  | 浮点型                   |
| motionX motionY motionZ | 返回玩家动量                                   | 浮点型                   |
| ticksExisted            | 返回玩家存在的游戏刻数                         | 整形                     |
| world                   | 返回WorldJS                                    | WorldJS[5]               |
| ridingEntity            | 返回玩家正在骑的实体                           | EntityJS(见后文)         |
| teamId                  | 返回玩家当前所在队伍名称                       | 字符串                   |
| customName              | 返回玩家自定义名称                             | Text                     |
| hasCustomName           | 返回玩家是否有自定义名称                       | 布尔值                   |
| customNameAlwaysVisible | 返回玩家自定义名称是否总是可见                 | 布尔值                   |
| eyeHeight               | 返回玩家视线高度                               | 浮点型                   |
| fullNBT                 | 返回玩家NBT                                    | CompoundTag              |
| inWater                 | 返回玩家是否在水里                             | 布尔值                   |
| underWater              | 返回玩家是否在水下                             | 布尔值                   |
| child                   | 返回是否为幼年个体(仅适用于实体)               | 布尔值                   |
| potionEffects           | 返回玩家具有的效果                             | EntityPotionEffectsJS[6] |
| lastDamageSource        | 返回玩家最后收到的伤害来源                     | DamageSourceJS[7]        |
| health                  | 返回玩家的血量                                 | 浮点型                   |
| maxHealth               | 返回玩家的最大血量                             | 浮点型                   |
| lastAttackedEntity      | 返回最后攻击的实体                             | LivingEntityJS[8]        |
| idleTime                | 返回玩家无动作时间                             | 整形                     |
| attackingEntity         | 返回玩家攻击的实体                             | LivingEntityJS           |
| mainHandItem            | 返回玩家主手物品                               | ItemStackJS              |
| offHandItem             | 返回玩家副手物品                               | ItemStackJS              |
| headArmorItem           | 返回玩家头盔物品                               | ItemStackJS              |
| chestArmorItem          | 返回玩家胸甲物品                               | ItemStackJS              |
| legsArmorItem           | 返回玩家腿甲物品                               | ItemStackJS              |
| feetArmorItem           | 返回玩家鞋子物品                               | ItemStackJS              |
| movementSpeed           | 返回玩家速度                                   | 浮点型                   |

注1：上述方法在使用时应接在 `event.player` 后，比如 `event.player.name` , 下同。

注2：上表所指玩家均可用于实体，比如 `event.player.invisible` 也可写为 `event.entity.invisible` （注明的除外）

[1] InventoryJS: 其支持的方法如下

| 格式                               | 功能                                  | 返回值      |
| ---------------------------------- | ------------------------------------- | ----------- |
| get(int 格子编号)                  | 返回指定格子的物品                    | ItemStackJS |
| set(int 格子编号,ItemStackJS 物品) | 设置指定格子的物品                    | void        |
| clear()                            | 清空玩家背包                          | void        |
| clear(ItemStackJS 物品)            | 清空玩家背包中指定物品                | void        |
| find()                             | 返回玩家背包中有物品的格子编号(1)     | 整形        |
| find(ItemStackJS 物品)             | 返回玩家背包中有指定物品的格子编号(1) | 整形        |
| count()                            | 返回物品背包中物品总数(2)             | 整形        |
| count(ItemStackJS 物品)            | 返回玩家背包中指定物品数(2)           | 整形        |

(1) 当无该物品时会返回 -1，有则为最小编号

(2) 当无物品时会返回 0

- 玩家物品栏格子编号(图源:Minecraft Wiki)：

  ![](https://patchwiki.biligame.com/images/mc/c/c6/g1edcd1iybb1x4tw6ntsvmvo5auixhl.png)
  
  经测试，貌似副手的编号为40而不是-106

[2] ItemStackJS: 见18章

[3] PlayerStatsJS: 其支持的方法如下

| 格式                       | 功能                                 | 返回值 |
| -------------------------- | ------------------------------------ | ------ |
| get(命名空间)              | 获取玩家指定项的统计信息             | 整形   |
| set(命名空间, 值)          | 设置玩家指定项的统计信息             | void   |
| add(命名空间, 值)          | 为玩家指定项的统计信息添加值         | void   |
| getBlocksMined(命名空间)   | 返回玩家破坏指定方块的统计信息的值   | 整形   |
| getItemsCrafted(命名空间)  | 返回玩家合成指定物品的统计信息的值   | 整形   |
| getItemsUsed(命名空间)     | 返回玩家使用指定物品的统计信息的值   | 整形   |
| getItemsBroken(命名空间)   | 返回玩家用坏指定物品的统计信息的值   | 整形   |
| getItemsPickedUp(命名空间) | 返回玩家捡起指定物品的统计信息的值   | 整形   |
| getItemsDropped(命名空间)  | 返回玩家丢弃指定物品的统计信息的值   | 整形   |
| getKilled(命名空间)        | 返回玩家杀死指定怪物的统计信息的值   | 整形   |
| getKilledBy(命名空间)      | 返回玩家被指定怪物杀死的统计信息的值 | 整形   |

[4] Stages用法见11-4和11-5

[5] WorldJS: 其支持的方法如下

| 格式      | 功能                 | 返回值          |
| --------- | -------------------- | --------------- |
| side      | 返回脚本执行端的环境 | ScriptTypeJS(1) |
| gameRules | 返回GameRulesJS      |                 |
|           |                      |                 |

[6]

[7]

[8] LivingEntityJS支持的方法与EntityJS的基本相同



##### 2、信息操作

| 格式 | 功能 | 返回值 |
| ---- | ---- | ------ |
|      |      |        |
|      |      |        |
|      |      |        |





[how can i get what dimension the player is in? - Leonariz (discord.com)](https://discord.com/channels/303440391124942858/933509729056092260)

event.player.inventory.clear('item:id')

https://discord.com/channels/303440391124942858/871128263160905809

```
const captureItem = 'minecraft:diamond'
const capturedItem = {name:'minecraft:emerald',displayName:'Soul Emerald'}
const pronounTest = (s,c) => {
    if (c) {
        return ''
    } else if (/[AEIOU].*/.test(s)) {
        return 'an '
    } else {
        return 'a '
    }
}
onEvent('item.right_click', event => {
    if (event.item.id === capturedItem.name) {
        event.server.runCommandSilent(`summon ${event.item.nbt.CapturedEntity} ${event.player.x} ${event.player.y + 0.7} ${event.player.z} ${event.item.nbt.CapturedData}`)
        event.item.count --
    }
})
onEvent('item.entity_interact', event => {
    if (event.item.id === captureItem && !event.target.player && event.target.type != 'minecraft:ender_dragon') { //Exclude the ender dragon as it doesn't like being tped around like this
        event.item.count --
        let nbt = event.target.fullNBT
        delete nbt.UUID
        event.server.runCommandSilent(`summon minecraft:item ${event.target.x} ${event.target.y} ${event.target.z} {PickupDelay:10,Motion:[0.0,0.2,0.0],Item:{id:"${capturedItem.name}",Count:1b,tag:{display:{Name:'{"text":"${capturedItem.displayName}","italic":false}',Lore:['{"text":"Contains the soul of ${pronounTest(event.target.name, nbt.CustomName)}${event.target.name}"}']},CapturedEntity: "${event.target.type}", CapturedData: ${nbt}}}}`)
        event.target.y = -400
        event.target.health = 1 //don't kill it immediately otherwise the death animation will be visible. The void will finish it off
    }
})
```

